@{
	Layout = null;
    var notificationsJson = TempData["Notifications"] as string;
}

@using core_web.Helpers
@using System.Text.Json

<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<meta name="description" content="Student Portal - SENSEI Japanese LMS">
	<meta name="author" content="SENSEI">

	<link rel="preconnect" href="https://fonts.gstatic.com">
	<link rel="shortcut icon" href="~/theme/v1/img/icons/icon-48x48.png" />

	<title>SENSEI Student | @ViewData["Title"]</title>

	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
	<link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />

	<link href="~/theme/v1/css/app.css" rel="stylesheet">
	<link href="~/css/custom.css" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@700;900&family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/notyf@3/notyf.min.css">
	<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
	<link href="https://cdn.jsdelivr.net/npm/select2-bootstrap-5-theme@1.3.0/dist/select2-bootstrap-5-theme.min.css" rel="stylesheet" />
	<link href="~/lib/sweetalert2/sweetalert2.bundle.css" rel="stylesheet">
	<link href="~/lib/ladda/dist/ladda-themeless.min.css" rel="stylesheet" />
	<link rel="stylesheet" href="https://cdn.datatables.net/1.13.8/css/dataTables.bootstrap5.min.css">
	<link href="https://cdn.jsdelivr.net/npm/bootstrap-datepicker@1.10.0/dist/css/bootstrap-datepicker.min.css" rel="stylesheet">

	<style>
        :root {
            --sensei-red: #D83236;
            --sensei-red-dark: #a11d21;
            --sakura-pink: #fff8f8;
            --sakura-accent: #ffefef;
            --glass-bg: rgba(255, 255, 255, 0.75);
            --premium-shadow: 0 10px 40px rgba(216, 50, 54, 0.08);
            --sidebar-bg: #222e3c;
        }

        /* üõ°Ô∏è Aggressive UI Fix: Completely remove any leaking global website components */
        header, .nav, .brand, .brand-link, .nav-links, .btn-login, .site-footer { 
            display: none !important; 
            height: 0 !important;
            visibility: hidden !important;
            margin: 0 !important;
            padding: 0 !important;
            position: absolute !important;
            top: -9999px !important;
        }

        body {
            margin-top: 0 !important;
            padding-top: 0 !important;
			font-family: 'Plus Jakarta Sans', sans-serif !important;
            background: linear-gradient(135deg, var(--sakura-pink) 0%, var(--sakura-accent) 100%) !important;
            color: #1a1a1a;
            min-height: 100vh;
		}

        /* Vertical Japanese Watermark */
        .jp-watermark {
            position: fixed;
            font-family: 'Noto Serif JP', serif;
            font-weight: 900;
            color: var(--sensei-red);
            opacity: 0.035;
            writing-mode: vertical-rl;
            z-index: 0;
            pointer-events: none;
            user-select: none;
        }

        .jp-wm-1 { top: 5%; left: 2%; font-size: 8rem; }
        .jp-wm-2 { bottom: 5%; right: 2%; font-size: 6rem; }
        .jp-wm-3 { top: 40%; right: 5%; font-size: 4rem; opacity: 0.02; }

		.sidebar-brand span {
			font-family: 'Noto Serif JP', serif !important;
            letter-spacing: 0.05em;
		}

		.card {
            background: var(--glass-bg) !important;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(216, 50, 54, 0.08) !important;
            border-radius: 16px !important;
            box-shadow: var(--premium-shadow) !important;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 50px rgba(216, 50, 54, 0.12) !important;
        }

		.card-title {
			font-weight: 800;
			letter-spacing: -0.02em;
			color: var(--sensei-red) !important;
            font-family: 'Plus Jakarta Sans', sans-serif;
		}

		.sidebar-link {
			font-weight: 600;
            transition: all 0.2s ease;
		}

        .sidebar-item.active .sidebar-link,
        .sidebar-item.active i {
            color: var(--sensei-red) !important;
            background: rgba(216, 50, 54, 0.05) !important;
        }

        .sidebar-item.active::before {
            content: "";
            position: absolute;
            left: 0;
            height: 100%;
            width: 4px;
            background: var(--sensei-red);
        }

        .content {
            padding: 2.5rem 1.5rem 1.5rem;
            position: relative;
            z-index: 1;
        }

        /* Buttons Premium */
        .btn-primary {
            background-color: var(--sensei-red) !important;
            border-color: var(--sensei-red) !important;
            border-radius: 8px !important;
            font-weight: 700 !important;
            box-shadow: 0 4px 15px rgba(216, 50, 54, 0.2) !important;
            transition: all 0.3s ease !important;
        }

        .btn-primary:hover {
            background-color: var(--sensei-red-dark) !important;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(216, 50, 54, 0.4) !important;
        }

        /* Disable any floating/annoying animations but keep watermarks */
        .sakura-container, .sakura-petal {
            display: none !important;
        }
	</style>
</head>

<body>
    <div class="jp-watermark jp-wm-1">Â≠¶Áîü</div>
    <div class="jp-watermark jp-wm-2">Â≠¶„Å≥</div>
    <div class="jp-watermark jp-wm-3">ÂÖàÁîü</div>

	<div class="wrapper">
		
		<!-- sidebar -->
		@Html.RenderAction("StudentSidebar", "Layout", new { area = "" })

		<div class="main">
			
			<!-- header -->
			@Html.RenderAction("StudentPortalHeader", "Layout", new { area = "" })

			<!-- body -->
			<main class="content">

				@RenderBody()

			</main>

			<!-- footer -->
			@Html.RenderAction("StudentPortalFooter", "Layout", new { area = "" })

		</div>

	</div>

	<!-- Core dependency -->
	<script src="~/lib/jquery/dist/jquery.min.js"></script>

	<!-- jQuery plugins that depend on jQuery -->
	<script src="~/lib/jquery-validation/dist/jquery.validate.min.js"></script>
	<script src="~/lib/jquery-validation-unobtrusive/dist/jquery.validate.unobtrusive.min.js"></script>
	<script src="~/lib/jquery-ajax-unobtrusive/dist/jquery.unobtrusive-ajax.min.js"></script>

	<!-- Bootstrap -->
	<script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>

	<!-- Site -->
	<script src="~/js/site.js"></script>

	<!-- UI / Icon libraries -->
	<script src="~/lib/feather/feather.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/notyf@3/notyf.min.js"></script>

	<!-- Form / UX Enhancements -->
	<script src="~/lib/select2-inspinia/select2.full.min.js"></script>
	<script src="~/lib/sweetalert2/sweetalert2.bundle.js"></script>

	<!-- Loading / Button state -->
	<script src="~/lib/ladda/dist/spin.min.js"></script>
	<script src="~/lib/ladda/dist/ladda.min.js"></script>

	<!-- Your global helpers -->
	<script src="~/js/global-function.js"></script>

	<!-- Data Table -->
	<script src="https://cdn.datatables.net/1.13.8/js/jquery.dataTables.min.js"></script>
	<script src="https://cdn.datatables.net/1.13.8/js/dataTables.bootstrap5.min.js"></script>

	<script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/8.0.0/signalr.min.js"></script>

	<script src="https://cdn.jsdelivr.net/npm/bootstrap-datepicker@1.10.0/dist/js/bootstrap-datepicker.min.js"></script>

	<script>

		window.notyf = new Notyf({
			 position: {
				x: 'right',
				y: 'top'
			},
			types: [
				{
					type: 'info',
					background: '#0dcaf0'
				},
				{
					type: 'warning',
					background: '#ffc107'
				}
			]
		});

		document.addEventListener("DOMContentLoaded", function () {

			if (window.feather) {
				feather.replace();
			}

			const notificationsJson = @Html.Raw(notificationsJson != null ? notificationsJson : "null");

			if (!notificationsJson || notificationsJson.length === 0) return;

			notificationsJson.forEach(n => {
				window.notyf.open({
					type: n.Type.toLowerCase(), // Notyf expects lowercase
					message: n.Message,
					duration: n.Duration,
					dismissible: n.Dismissible,
					position: {
						x: n.PositionX,
						y: n.PositionY
					}
				});
			});

		});
	</script>

	<!--SignalR Connections-->
	<script>

		$(document).ready(function () {

			const notificationConnection = new signalR.HubConnectionBuilder()
				.withUrl("/hubs/notifications")
				.build();

			notificationConnection.on("ReceiveNotification", function (data) {

				popUpNotification('success', data.message);

				const html = `
					<a href="#" class="list-group-item">
						<div class="row g-0 align-items-center">
							<div class="col-2">
								<i class="text-warning" data-feather="${data.icon}"></i>
							</div>
							<div class="col-10">
								<div class="text-dark">${data.title}</div>
								<div class="text-muted small mt-1">${data.message}</div>
								<div class="text-muted small mt-1">
									${formatDate(data.createdAt)}
								</div>
							</div>
						</div>
					</a>
				`;

				$("#userNotificationlist").prepend(html);

				if (window.feather) {
					feather.replace();
				}

			});

			notificationConnection.start();
		});

		function formatDate(dateStr) {
			const d = new Date(dateStr);
			return d.toLocaleDateString("en-GB") + " " + d.toLocaleTimeString("en-GB", { hour: '2-digit', minute: '2-digit' });
		}

	</script>

	@await RenderSectionAsync("Scripts", required: false)

</body>

</html>

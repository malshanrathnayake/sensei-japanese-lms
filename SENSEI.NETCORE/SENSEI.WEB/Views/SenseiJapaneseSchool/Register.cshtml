@using SENSEI.DOMAIN

@model StudentRegistration

@{
    Layout = "~/Views/Shared/_AuthLayout.cshtml";
    ViewData["Title"] = "Register";
}


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
<link href="https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@700;900&family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">

<style>
    /* Sakura Theme Matching Home Page */
    :root {
        --bg-main: #fffcfc;
        --primary: #D83236;
        --primary-dark: #a11d21;
        --primary-glow: rgba(216, 50, 54, 0.15);
        --accent-sakura: #fff5f5;
        --text-main: #1a1a1a;
        --text-muted: #666666;
        --glass-bg: rgba(255, 255, 255, 0.92);
        --card-shadow: 0 25px 60px -15px rgba(216, 50, 54, 0.12);
    }

    body {
        font-family: 'Plus Jakarta Sans', sans-serif !important;
        background: linear-gradient(135deg, #fffcfc 0%, #fff0f0 100%) !important;
        position: relative;
        min-height: 100vh;
    }

    /* Fixed Atmospheric Background Watermarks */
    body::before {
        content: "先生";
        position: fixed;
        bottom: 5%;
        right: 2%;
        font-family: 'Noto Serif JP', serif;
        font-size: 15rem;
        font-weight: 900;
        color: var(--primary);
        opacity: 0.03;
        z-index: -1;
        pointer-events: none;
        user-select: none;
    }

    body::after {
        content: "日本語";
        position: fixed;
        top: 15%;
        left: 2%;
        font-family: 'Noto Serif JP', serif;
        font-size: 12rem;
        font-weight: 900;
        color: var(--primary);
        opacity: 0.03;
        z-index: -1;
        pointer-events: none;
        user-select: none;
        transform: rotate(-10deg);
    }

    .card {
        background: var(--glass-bg) !important;
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.8) !important;
        border-radius: 24px !important;
        box-shadow: var(--card-shadow) !important;
        margin-bottom: 2.5rem;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        overflow: hidden;
    }

    .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 35px 70px -10px rgba(216, 50, 54, 0.18) !important;
    }

    .card-header {
        background: linear-gradient(90deg, rgba(216, 50, 54, 0.08), transparent) !important;
        border-bottom: 1px solid rgba(216, 50, 54, 0.05) !important;
        padding: 1.5rem 2rem !important;
        position: relative;
    }

    .card-header::before {
        content: "";
        position: absolute;
        left: 0;
        top: 50%;
        transform: translateY(-50%);
        width: 4px;
        height: 60%;
        background: var(--primary);
        border-radius: 0 4px 4px 0;
    }

    .card-title {
        color: var(--text-main) !important;
        font-weight: 800 !important;
        font-size: 1.1rem !important;
        display: flex;
        align-items: center;
        gap: 12px;
    }

    .card-title i {
        color: var(--primary);
        font-size: 1.2rem;
    }

    .btn-primary {
        background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%) !important;
        border: none !important;
        border-radius: 16px !important;
        padding: 1.2rem 3rem !important;
        font-weight: 800 !important;
        font-size: 1.1rem !important;
        letter-spacing: 0.02em;
        box-shadow: 0 15px 35px rgba(216, 50, 54, 0.35) !important;
        transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) !important;
    }

    .btn-primary:hover {
        transform: translateY(-4px) scale(1.02);
        box-shadow: 0 20px 45px rgba(216, 50, 54, 0.45) !important;
    }

    /* Navigation Header Refinement */
    .nav-header {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        z-index: 1000;
        background: rgba(255, 255, 255, 0.8);
        backdrop-filter: blur(15px);
        border-bottom: 1px solid rgba(216, 50, 54, 0.05);
        padding: 0.5rem 0;
    }

    .nav-header::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 3px;
        background: linear-gradient(90deg, var(--primary), #ffb7c5, var(--primary));
        background-size: 200% auto;
        animation: flow 4s linear infinite;
        z-index: 1100;
    }

    @@keyframes flow {
        0% { background-position: 0% 50%; }
        100% { background-position: 200% 50%; }
    }

    .nav-container {
        max-width: 1280px;
        width: 100%;
        margin: 0 auto;
        padding: 0.4rem 2rem;
        display: flex;
        align-items: center;
        justify-content: space-between;
    }

    .nav-brand {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        text-decoration: none;
    }

    .brand-logo-small {
        width: 50px;
        height: 50px;
        object-fit: contain;
    }

    .brand-name-img {
        height: 1.6rem;
        width: auto;
        object-fit: contain;
    }

    .nav-links {
        display: flex;
        gap: 0.5rem;
        align-items: center;
    }

    .nav-links a {
        text-decoration: none;
        color: var(--text-main);
        font-weight: 700;
        padding: 0.6rem 1.2rem;
        border-radius: 99px;
        font-size: 0.95rem;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
    }

    .nav-links a:hover {
        color: var(--primary);
        background: rgba(216, 50, 54, 0.06);
    }

    .btn-link-home {
        text-decoration: none !important;
        color: var(--text-main) !important;
        font-weight: 800 !important;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .btn-link-home:hover {
        color: var(--primary) !important;
    }

    .register-wrapper {
        padding-top: 120px;
    }


    .form-label {
        font-weight: 700;
        color: var(--text-main);
        font-size: 0.85rem;
        margin-bottom: 0.5rem;
        display: flex;
        align-items: center;
        gap: 6px;
    }

    .form-label i {
        color: var(--primary);
        font-size: 0.9rem;
        opacity: 0.7;
    }

    .form-control, .form-select {
        height: 52px !important;
        border-radius: 14px !important;
        border: 1px solid #f0f0f0 !important;
        padding: 0 1.25rem !important;
        background: #fdfdfd !important;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        font-size: 0.95rem !important;
    }

    .form-control:focus, .form-select:focus {
        border-color: var(--primary) !important;
        box-shadow: 0 0 0 5px var(--primary-glow) !important;
        background: #fff !important;
        transform: scale(1.002);
    }

    /* Multi-step indicator or current view vibe */
    .registration-progress {
        display: flex;
        justify-content: center;
        gap: 15px;
        margin-bottom: 3rem;
    }

    .progress-step {
        width: 40px;
        height: 8px;
        border-radius: 4px;
        background: #eee;
        transition: all 0.5s ease;
    }

    .progress-step.active {
        width: 60px;
        background: var(--primary);
        box-shadow: 0 0 15px var(--primary-glow);
    }

    .register-header h1 {
        font-family: 'Noto Serif JP', serif;
        font-weight: 900;
        color: var(--text-main);
        letter-spacing: -0.02em;
    }

    .form-group-wrap {
        position: relative;
    }

    /* Select2 Dropdown Visibility Fix */
    .select2-container {
        z-index: 9999 !important;
        display: block !important;
        width: 100% !important;
    }

    .select2-container .select2-selection--single {
        height: 48px !important;
        border-radius: 12px !important;
        border: 1px solid #ffe0e0 !important;
        background: #fff !important;
        display: flex !important;
        align-items: center !important;
        padding-left: 8px !important;
        position: relative !important;
    }

    .select2-container--bootstrap5 .select2-selection--single .select2-selection__rendered {
        color: var(--text-main) !important;
        line-height: normal !important;
        padding-left: 4px !important;
        flex: 1;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }

    .select2-container--bootstrap5 .select2-selection--single .select2-selection__arrow {
        position: absolute !important;
        right: 15px !important;
        top: 50% !important;
        transform: translateY(-50%) !important;
        width: 20px !important;
        height: 20px !important;
        background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3e%3cpath fill='none' stroke='%23ff5a5f' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='m2 5 6 6 6-6'/%3e%3c/svg%3e") !important;
        background-repeat: no-repeat !important;
        background-position: center !important;
        background-size: 12px !important;
    }

    .select2-container--bootstrap5 .select2-selection--single .select2-selection__clear {
        position: absolute !important;
        right: 40px !important;
        top: 50% !important;
        transform: translateY(-50%) !important;
        margin-top: 0 !important;
        background: none !important;
        font-weight: bold !important;
        font-size: 1.2rem !important;
        color: #ff8a8f !important;
        cursor: pointer !important;
        z-index: 10 !important;
    }

    .select2-container--bootstrap5 .select2-selection--single .select2-selection__clear:hover {
        color: var(--primary) !important;
    }

    .select2-dropdown {
        background: #fff !important;
        border: 1px solid #ffd8c5 !important;
        border-radius: 12px !important;
        box-shadow: 0 10px 30px rgba(255, 90, 95, 0.15) !important;
        z-index: 99999 !important; /* Extremely high to beat any other layers */
    }

    /* ITI Override to prevent overlap */
    .iti { width: 100%; display: block; }
    
    /* Phone Number dropdown styling when opening in document.body */
    .iti__country-list { 
        z-index: 99999 !important; 
        background-color: #ffffff !important;
        border: 1px solid #ffd8c5 !important;
        border-radius: 12px !important;
        box-shadow: 0 10px 30px rgba(255, 90, 95, 0.15) !important;
        max-height: 280px !important;
    }
    
    .iti input#PhoneNo {
        padding-left: 95px !important; 
        height: 48px !important;
    }
    
    .iti--separate-dial-code .iti__selected-dial-code {
        margin-left: 8px;
        font-weight: 700;
        color: var(--primary);
    }

    /* Logo Box for Consistency with Login */
    .logo-box {
        text-align: center;
        margin-bottom: 2rem;
    }

    .brand-logo {
        width: 80px;
        height: 80px;
        object-fit: contain;
    }
    
    @@media (max-width: 768px) {
        .nav-links { display: none; }
        .nav-header { padding: 1rem 1.5rem; }
        .register-wrapper { padding-top: 100px; }
    }

</style>

<!-- intl-tel-input -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/intl-tel-input@23.0.1/build/css/intlTelInput.css">

<header class="nav-header">
    <div class="nav-container">
        <a href="~/" class="nav-brand">
            <img src="~/theme/v1/img/photos/logo.PNG" alt="Sensei Logo" class="brand-logo-small" />
            <div class="brand-text">
                <img src="~/theme/v1/img/photos/name1.png" alt="Sensei Japanese Center" class="brand-name-img" />
                <img src="~/theme/v1/img/photos/name.png" alt="Name" class="brand-name-img" />
            </div>
        </a>
        <nav class="nav-links">
            <a href="~/#courses">Courses</a>
            <a href="~/SenseiJapaneseSchool/Gallery">Gallery</a>
            <a href="~/" class="btn-link-home"><i class="fas fa-home"></i> Home</a>
        </nav>
    </div>
</header>

@* Removed Sakura Decoration *@

<div class="container register-wrapper d-flex flex-column">

    <div class="text-center mb-5 mt-4 register-header">
        <div class="logo-box">
            <img src="~/theme/v1/img/photos/logo.PNG" alt="Sensei Logo" class="brand-logo" style="filter: drop-shadow(0 10px 20px rgba(216, 50, 54, 0.1));" />
        </div>
        <h1 class="display-5">Japanese Online Registration</h1>
        <p class="text-muted" style="font-size: 1.1rem; max-width: 600px; margin: 0 auto;">Join 10,000+ students mastering Japanese at the Sensei Center 🌸</p>
    </div>

    <div class="registration-progress">
        <div class="progress-step active"></div>
        <div class="progress-step"></div>
        <div class="progress-step"></div>
    </div>

    <form asp-action="Register" asp-controller="SenseiJapaneseSchool" asp-area="" method="post" id="student-register">

        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title mb-0 fw-bold"><i class="fas fa-user-circle"></i> Personal Information</h5>
                    </div>
                    <div class="card-body p-4 p-lg-5">

                        <div class="row">

                            <div class="col-xl-4 col-lg-4 col-md-6 col-sm-12 mb-4">
                                <label class="form-label" asp-for="Initials"><i class="fas fa-id-card"></i> Initials (Optional)</label>
                                @Html.TextBoxFor(m => m.Initials, new { @class = "form-control", placeholder = "e.g. A.B.C." })
                                @* <span asp-validation-for="Initials" class="text-danger"></span> *@
                            </div>

                            <div class="col-xl-4 col-lg-4 col-md-6 col-sm-12 mb-4">
                                <label class="form-label" asp-for="FirstName"><i class="fas fa-signature"></i> First Name *</label>
                                @Html.TextBoxFor(m => m.FirstName, new { @class = "form-control", placeholder = "First Name" })
                                <span asp-validation-for="FirstName" class="text-danger"></span>
                            </div>

                            <div class="col-xl-4 col-lg-4 col-md-6 col-sm-12 mb-4">
                                <label class="form-label" asp-for="MiddleName"><i class="fas fa-signature"></i> Middle Name (Optional)</label>
                                @Html.TextBoxFor(m => m.MiddleName, new { @class = "form-control", placeholder = "Middle Name" })
                                @* <span asp-validation-for="MiddleName" class="text-danger"></span> *@
                            </div>

                            <div class="col-xl-4 col-lg-4 col-md-6 col-sm-12 mb-4">
                                <label class="form-label" asp-for="LastName"><i class="fas fa-signature"></i> Last Name *</label>
                                @Html.TextBoxFor(m => m.LastName, new { @class = "form-control", placeholder = "Last Name" })
                                <span asp-validation-for="LastName" class="text-danger"></span>
                            </div>

                            <div class="col-xl-4 col-lg-4 col-md-6 col-sm-12 mb-4">
                                <label class="form-label" asp-for="CallingName"><i class="fas fa-comment-dots"></i> Calling Name (Optional)</label>
                                @Html.TextBoxFor(m => m.CallingName, new { @class = "form-control", placeholder = "Calling Name" })
                                @* <span asp-validation-for="CallingName" class="text-danger"></span> *@
                            </div>

                            <div class="col-xl-4 col-lg-4 col-md-6 col-sm-12 mb-4">
                                <label class="form-label" asp-for="NIC"><i class="fas fa-fingerprint"></i> NIC *</label>
                                @Html.TextBoxFor(m => m.NIC, new { @class = "form-control", placeholder = "Identity Card No" })
                                <span asp-validation-for="NIC" class="text-danger"></span>
                            </div>

                            <div class="col-xl-4 col-lg-4 col-md-6 col-sm-12 mb-4">
                                <label class="form-label" asp-for="DateOfBirth"><i class="fas fa-calendar-alt"></i> Date Of Birth *</label>
                                @Html.TextBoxFor(m => m.DateOfBirth, new { @class = "form-control datepicker", placeholder = "Select Birth Date" })
                                <span asp-validation-for="DateOfBirth" class="text-danger"></span>
                            </div>

                        </div>

                    </div>
                </div>
            </div>
        </div>

                    <div class="row">
            <div class="col-12">
                <div class="card shadow-sm border-0">
                    <div class="card-header">
                        <h5 class="card-title mb-0 fw-bold"><i class="fas fa-map-marker-alt"></i> Contact Information</h5>
                    </div>
                    <div class="card-body p-4 p-lg-5">

                        <div class="row">

                            <div class="col-xl-4 col-lg-4 col-md-6 col-sm-12 mb-4">
                                <label class="form-label" asp-for="AddressLineOne"><i class="fas fa-home"></i> Address Line One *</label>
                                @Html.TextBoxFor(m => m.AddressLineOne, new { @class = "form-control", placeholder = "Street address" })
                                <span asp-validation-for="AddressLineOne" class="text-danger"></span>
                            </div>

                            <div class="col-xl-4 col-lg-4 col-md-6 col-sm-12 mb-4">
                                <label class="form-label" asp-for="AddressLineTwo"><i class="fas fa-building"></i> Address Line Two</label>
                                @Html.TextBoxFor(m => m.AddressLineTwo, new { @class = "form-control", placeholder = "Apt / Suite / Floor (Optional)" })
                                <span asp-validation-for="AddressLineTwo" class="text-danger"></span>
                            </div>

                            <div class="col-xl-4 col-lg-4 col-md-6 col-sm-12 mb-4">
                                <label class="form-label" asp-for="PostalCode"><i class="fas fa-mail-bulk"></i> Postal Code (Optional)</label>
                                @Html.TextBoxFor(m => m.PostalCode, new { @class = "form-control", placeholder = "Zip Code" })
                                <span asp-validation-for="PostalCode" class="text-danger"></span>
                            </div>

                            <div class="col-xl-4 col-lg-4 col-md-6 col-sm-12 mb-4">
                                <div id="country-wrapper">
                                    <label class="form-label"><i class="fas fa-globe"></i> Country *</label>
                                    <select id="CountryId" class="form-control country-select" name="CountryId" asp-for="CountryId"></select>
                                    <span asp-validation-for="CountryId" class="text-danger"></span>
                                </div>
                            </div>

                            <div class="col-xl-4 col-lg-4 col-md-6 col-sm-12 mb-4">
                                <label class="form-label" asp-for="State"><i class="fas fa-map"></i> State / Region</label>
                                @Html.TextBoxFor(m => m.State, new { @class = "form-control", placeholder = "State / Province" })
                                <span asp-validation-for="State" class="text-danger"></span>
                            </div>

                            <div class="col-xl-4 col-lg-4 col-md-6 col-sm-12 mb-4">
                                <label class="form-label" asp-for="City"><i class="fas fa-city"></i> City *</label>
                                @Html.TextBoxFor(m => m.City, new { @class = "form-control", placeholder = "City" })
                                <span asp-validation-for="City" class="text-danger"></span>
                            </div>

                            <div class="col-xl-4 col-lg-4 col-md-6 col-sm-12 mb-4">
                                <label class="form-label d-block" asp-for="PhoneNo"><i class="fas fa-phone-alt"></i> Phone Number *</label>
                                @Html.TextBoxFor(m => m.PhoneNo, new { @class = "form-control w-100", id = "PhoneNo", type = "tel" })
                                <span id="phone-error" class="text-danger d-none mt-1 small">Invalid international phone number.</span>
                            </div>

                            <div class="col-xl-4 col-lg-4 col-md-6 col-sm-12 mb-4">
                                <label class="form-label" asp-for="Email"><i class="fas fa-envelope"></i> Email *</label>
                                @Html.TextBoxFor(m => m.Email, new { @class = "form-control", placeholder = "Email Address", type = "email" })
                                <span asp-validation-for="Email" class="text-danger"></span>
                            </div>

                        </div>

                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-12">
                <div class="card shadow-sm border-0">
                    <div class="card-header">
                        <h5 class="card-title mb-0 fw-bold">Course Information</h5>
                    </div>
                    <div class="card-body py-4">

                        <div class="row g-3">

                            <div class="col-xl-4 col-lg-4 col-md-6 col-sm-12">
                                <div class="mb-3" id="learningmode-wrapper">
                                    <label class="form-label">Learning Mode *</label>
                                    <select id="StudentLearningModeId" class="form-control learningmode-select" name="StudentLearningModeId" asp-for="StudentLearningModeId"></select>
                                    <span asp-validation-for="StudentLearningModeId" class="text-danger"></span>
                                </div>
                            </div>

                            <div class="col-xl-4 col-lg-4 col-md-6 col-sm-12" id="branch-field">
                                <div class="mb-3" id="branch-wrapper">
                                    <label class="form-label" asp-for="BranchId">Branch *</label>
                                    <select id="BranchId" class="form-control branch-select" name="BranchId" asp-for="BranchId"></select>
                                    <span asp-validation-for="BranchId" class="text-danger"></span>
                                </div>
                            </div>

                            <div class="col-xl-4 col-lg-4 col-md-6 col-sm-12">
                                <div class="mb-3" id="course-wrapper">
                                    <label class="form-label" asp-for="CourseId">Course *</label>
                                    <select id="CourseId" class="form-control course-select" name="CourseId" asp-for="CourseId"></select>
                                    <span asp-validation-for="CourseId" class="text-danger"></span>
                                </div>
                            </div>

                        </div>

                    </div>
                </div>
            </div>
        </div>

        <div class="text-center mt-4 mb-5">
            <button type="submit" class="btn-primary" style="min-width: 250px;" id="btnRegister">
                <i class="fas fa-paper-plane me-2"></i> Complete Registration Now
            </button>
        </div>

    </form>
</div>

@* Falling Sakura script removed *@

@section Scripts {

    <script src="https://cdn.jsdelivr.net/npm/intl-tel-input@23.0.1/build/js/intlTelInput.min.js"></script>

    <style>
        .iti { width: 100%; }
        .is-invalid + .iti { border: 1px solid #dc3545; border-radius: 0.25rem; }
        .form-control.is-invalid {
            border-color: #dc3545 !important;
            background-image: none !important;
        }
    </style>

    <script type="text/javascript">
    
        $(document).ready(function () {

            // Initialize Phone Input
            const phoneInputField = document.querySelector("#PhoneNo");
            const phoneError = document.querySelector("#phone-error");
            
            const iti = window.intlTelInput(phoneInputField, {
                initialCountry: "auto",
                geoIpLookup: callback => {
                    fetch("https://ipapi.co/json")
                        .then(res => res.json())
                        .then(data => callback(data.country_code.toLowerCase()))
                        .catch(() => callback("lk"));
                },
                utilsScript: "https://cdn.jsdelivr.net/npm/intl-tel-input@23.0.1/build/js/utils.js",
                separateDialCode: true,
                autoPlaceholder: "aggressive",
                formatOnDisplay: true,
                dropdownContainer: document.body // Fixes visibility/clipping issues
            });

            // Help Select2 data load
            const initCountryDropdown = (data) => {
                 loadSelectBox({
                    data: data,
                    className: 'country-select',
                    title: 'Select Country',
                    dropdownParentId: 'country-wrapper' // Re-added with better CSS
                });
            };

            const validatePhone = () => {
                if (phoneInputField.value.trim()) {
                    if (iti.isValidNumber()) {
                        phoneError.classList.add("d-none");
                        phoneInputField.classList.remove("is-invalid");
                        return true;
                    } else {
                        phoneError.classList.remove("d-none");
                        phoneInputField.classList.add("is-invalid");
                        return false;
                    }
                }
                return true; // Optional field bypass if empty, but here it's usually required
            };

            phoneInputField.addEventListener('blur', validatePhone);
            phoneInputField.addEventListener('change', validatePhone);

            // Sync Country Dropdown with Phone
            // phoneInputField.addEventListener("countrychange", function() {
            //     const countryData = iti.getSelectedCountryData();
            //     if (countryData && countryData.iso2) {
            //         $('#CountryId').val(countryData.iso2.toUpperCase()).trigger('change');
            //     }
            // });

            // Load Countries
            $.getJSON('/SenseiJapaneseSchool/GetCountryListJsonResult', function (data) {
                //initCountryDropdown(data);

                // Initial sync from ITI
                // const countryData = iti.getSelectedCountryData();
                // if (countryData && countryData.iso2) {
                //     $('#CountryId').val(countryData.iso2.toUpperCase()).trigger('change');
                // }

                loadSelectBox({
                    data: data,
                    className: 'country-select',
                    title: 'Select Country',
                    dropdownParentId: 'country-wrapper' 
                });
            });

            // Load Learning Modes
            $.getJSON('/SenseiJapaneseSchool/GetLearningModeListJsonResult', function (data) {
                loadSelectBox({
                    data: data,
                    className: 'learningmode-select',
                    title: 'Select Learning Mode',
                    dropdownParentId: 'learningmode-wrapper'
                });
            });

            // Load Courses
            $.getJSON('/SenseiJapaneseSchool/GetCourseListJsonResult', function (data) {
                loadSelectBox({
                    data: data,
                    className: 'course-select',
                    title: 'Select Course',
                    dropdownParentId: 'course-wrapper'
                });
            });

            // Load Branches
            $.getJSON('/SenseiJapaneseSchool/GetBranchListJsonResult', function (data) {
                loadSelectBox({
                    data: data,
                    className: 'branch-select',
                    title: 'Select Branch',
                    dropdownParentId: 'branch-wrapper'
                });
            });

            // Datepicker
            $('#DateOfBirth').datepicker({
                format: 'yyyy-mm-dd',
                autoclose: true,
                todayHighlight: true,
                startView: 2,
                endDate: new Date()
            });

            // Select2 change triggers validation
            $('select').on('change', function() {
                $(this).valid(); 
            });

            // Form Validation Configuration
            $("#student-register").validate({
                rules: {
                    FirstName: "required",
                    LastName: "required",
                    NIC: "required",
                    DateOfBirth: "required",
                    AddressLineOne: "required",
                    City: "required",
                    Email: {
                        required: true,
                        email: true
                    },
                    CountryId: {
                        required: true,
                        min: 1
                    },
                    StudentLearningModeId: {
                        required: true,
                        min: 1
                    },
                    BranchId: {
                        required: true,
                        min: 1
                    },
                    CourseId: {
                        required: true,
                        min: 1
                    }
                },
                messages: {
                    FirstName: "Please enter your first name",
                    LastName: "Please enter your last name",
                    NIC: "Please enter your NIC number",
                    DateOfBirth: "Birth date is required",
                    AddressLineOne: "Primary address is required",
                    City: "Please enter your city",
                    Email: "Enter a valid email address",
                    CountryId: "Please select your country",
                    StudentLearningModeId: "Select a learning mode",
                    BranchId: "Select a branch",
                    CourseId: "Select a course"
                },
                errorClass: "text-danger small mt-1",
                errorElement: "div",
                highlight: function(element) {
                    $(element).addClass("is-invalid");
                    $(element).siblings(".select2-container").addClass("is-invalid-select2");
                },
                unhighlight: function(element) {
                    $(element).removeClass("is-invalid");
                    $(element).siblings(".select2-container").removeClass("is-invalid-select2");
                },
                submitHandler: function(form) {
                    if (validatePhone()) {
                        $("#btnRegister").prop('disabled', true).html('<i class="fas fa-spinner fa-spin"></i> Processing...');
                        phoneInputField.value = iti.getNumber();
                        form.submit();
                    } else {
                        window.notyf.error("Please enter a valid phone number.");
                        return false;
                    }
                }
            });

        });
    </script>
}